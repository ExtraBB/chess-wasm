@page "/"
@inject IJSRuntime JsRuntime;
@using ChessWasm.Models;
@using ChessWasm.Services;
@using ChessWasm.Components;

<h1>Hello, world!</h1>

<div>
    <button @onclick="StartGame">New Game</button>
    <button @onclick="RandomMove">Random Move</button>
</div>

<ChessBoard @ref="chessBoard" @bind-Squares="squares" />

@code {
    private GameService gameService = new GameService();
    private sbyte[] squares = null;
    ChessBoard chessBoard;

    Random rand = new Random();

    private void StartGame()
    {
        gameService.StartGame();
        gameService.CurrentGame.Board.BoardChanged += BoardChanged;
        squares = gameService.CurrentGame.Board.Squares;
    }

    private void RandomMove()
    {
        int from = rand.Next(0, 64);
        int to = rand.Next(0, 64);
        gameService.CurrentGame.MakeMove(from, to);
    }

    private void BoardChanged(object sender, BoardChangedEventArgs args) 
    {
        chessBoard.SquaresChanged.InvokeAsync((sender as Board).Squares);
    }
}
