@page "/"
@inject IJSRuntime JsRuntime;
@using ChessWasm.Models;
@using ChessWasm.Services;
@using ChessWasm.Shared;

<h1>Hello, world!</h1>

<div>
    <button @onclick="StartGame">New Game</button>
    <button @onclick="() => GameService.RandomMove()">Random Move</button>
</div>

<ChessBoard @ref="chessBoard" @bind-Squares="squares" /> 

@code {
    private Piece[] squares = null;
    ChessBoard chessBoard;

    Random rand = new Random();

    private void StartGame()
    {
        GameService.StartGame();
        GameService.CurrentGame.Board.BoardChanged += BoardChanged;
        squares = GameService.CurrentGame.Board.Squares;
    }


    private void BoardChanged(object sender, BoardChangedEventArgs args) 
    {
        chessBoard.SquaresChanged.InvokeAsync((sender as Board).Squares);
    }
}
